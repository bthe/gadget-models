timestep = mfdb_timestep_quarterly,
year = 1980:2015,
species = 'COD')
reitmapping <- read.table(
system.file("demo-data", "reitmapping.tsv", package="mfdb"),
header=TRUE,
as.is=TRUE)
defaults <- list(
area = mfdb_group("1" = unique(reitmapping$SUBDIVISION)),
timestep = mfdb_timestep_quarterly,
year = 1980:2015,
species = 'COD')
gfs.landings <- data.frame(year=defaults$year,step=1,number=1,area=1)
igfs.fleet <-
Rgadget:::make.gadget.fleet(name='igfs',suitability='exponentiall50',
fleet.data=igfs.landings,
stocknames=c('codimm','codmat'))
aut.landings <- data.frame(year=defaults$year,step=1,number=1,area=1)
aut.fleet <-
Rgadget:::make.gadget.fleet(name='aut',suitability='exponentiall50',
fleet.data=aut.landings,
stocknames=c('codimm','codmat'))
old.fleet <-
Rgadget:::make.gadget.fleet(name='oldfleet',suitability='exponentiall50',
fleet.data=old.landings[[1]],
stocknames=c('codimm','codmat'))
foreign.fleet <-
Rgadget:::make.gadget.fleet(name='foreign',suitability='exponentiall50',
fleet.data=foreign.landings[[1]],
stocknames=c('codimm','codmat'))
foreign.fleet@suitability <-  old.fleet@suitability
aut.landings <- data.frame(year=defaults$year,step=1,number=1,area=1)
aut.fleet <-
Rgadget:::make.gadget.fleet(name='aut',suitability='exponentiall50',
fleet.data=aut.landings,
stocknames=c('codimm','codmat'))
igfs.landings <- data.frame(year=defaults$year,step=1,number=1,area=1)
igfs.fleet <-
Rgadget:::make.gadget.fleet(name='igfs',suitability='exponentiall50',
fleet.data=igfs.landings,
stocknames=c('codimm','codmat'))
gm@fleets <- list(old.fleet,igfs.fleet,aut.fleet,lln.fleet,gil.fleet,bmt.fleet,foreign.fleet)
gd <- gadget_directory("../02-mfdbcod")
gadget_dir_write(as.list(gd),gm)
class(gd)<-'list'
gadget_dir_write(as.list(gd),gm)
Rgadget::gadget_dir_write(as.list(gd),gm)
Rgadget:::gadget_dir_write(as.list(gd),gm)
source('~/Dropbox/gadget-models/01-cod/00-data/setup-fleets.R')
gm@fleets <- list(old.fleet,igfs.fleet,aut.fleet,lln.fleet,gil.fleet,bmt.fleet,foreign.fleet)
Rgadget:::gadget_dir_write(as.list(gd),gm)
opt$stocks$imm$transitionstocksandratios
setwd(gd$dir)
callGadget(s=1)
init.params <- read.gadget.parameters('params.out')
View(init.params)
init.params['Linf',]
init.params[c('Linf','k'),]
init.params[c('Linf','k'),-1] <- data.frame()
init.params[c('Linf','k'),-1]
grep('age',rownames(init.params))
grep(c('Linf','age'),rownames(init.params))
grep('age',rownames(init.params),values=TRUE)
grep('age',rownames(init.params),value=TRUE)
init.params[c('Linf','k','bbin',grep('age',rownames(init.params),value=TRUE),'mat1','mat2')]
init.params[c('Linf','k','bbin',grep('age',rownames(init.params),value=TRUE),'mat1','mat2'),]
init.params[c('Linf','k','bbin',grep('age',rownames(init.params),value=TRUE),'mat1','mat2'),] <-
read.table(text='switch	value		lower	upper	optimise
Linf	         160	      80     2000        0
k	          90	       1      200        1
bbin	         6	   1e-08    100        1
mult	         1000	     0.1      1000        1
age2	         35	    0.01     150        1
age3	         25	    0.01     120        1
age4	         15	   0.001     100        1
age5	          7	  0.0001     100        1
age6	          7	   1e-05     100        1
age7	          5	   1e-08     100        1
age8	          5	   1e-10     100        1
age9	         25	   1e-12     100        1
age10	         10	   1e-15     100        1
age11	         10	   1e-15    1e+05        1
mat1	          70	      10      200        1
mat2	          70	      30      100        1')
init.params <- read.gadget.parameters('params.out')
init.params[c('Linf','k','bbin',grep('age',rownames(init.params),value=TRUE),'mat1','mat2'),] <-
read.table(text='switch	value		lower	upper	optimise
Linf	         160	      80     2000        0
k	          90	       1      200        1
bbin	         6	   1e-08    100        1
mult	         1000	     0.1      1000        1
age2	         35	    0.01     150        1
age3	         25	    0.01     120        1
age4	         15	   0.001     100        1
age5	          7	  0.0001     100        1
age6	          7	   1e-05     100        1
age7	          5	   1e-08     100        1
age8	          5	   1e-10     100        1
age9	         25	   1e-12     100        1
age10	         10	   1e-15     100        1
age11	         10	   1e-15    1e+05        1
mat1	          70	      10      200        1
mat2	          70	      30      100        1',header=TRUE)
read.table(text='switch	value		lower	upper	optimise
Linf	         160	      80     2000        0
k	          90	       1      200        1
bbin	         6	   1e-08    100        1
mult	         1000	     0.1      1000        1
age2	         35	    0.01     150        1
age3	         25	    0.01     120        1
age4	         15	   0.001     100        1
age5	          7	  0.0001     100        1
age6	          7	   1e-05     100        1
age7	          5	   1e-08     100        1
age8	          5	   1e-10     100        1
age9	         25	   1e-12     100        1
age10	         10	   1e-15     100        1
age11	         10	   1e-15    1e+05        1
mat1	          70	      10      200        1
mat2	          70	      30      100        1',header=TRUE)
init.params[c('Linf','k','bbin',grep('age',rownames(init.params),value=TRUE),'mat1','mat2'),] <-
read.table(text='switch	value		lower	upper	optimise
Linf	         160	      80     2000        0
k	          90	       1      200        1
bbin	         6	   1e-08    100        1
age2	         35	    0.01     150        1
age3	         25	    0.01     120        1
age4	         15	   0.001     100        1
age5	          7	  0.0001     100        1
age6	          7	   1e-05     100        1
age7	          5	   1e-08     100        1
age8	          5	   1e-10     100        1
age9	         25	   1e-12     100        1
age10	         10	   1e-15     100        1
age11	         10	   1e-15    1e+05        1
mat1	          70	      10      200        1
mat2	          70	      30      100        1',header=TRUE)
gm@stocks$imm@initialdata
gm@stocks$imm@initialdata$area.factor <- '( * 100 #mult)'
gm@stocks$mat@initialdata$area.factor <- '( * 100 #mult)'
setwd('../00-data')
Rgadget:::gadget_dir_write(as.list(gd),gm)
setwd(gd$dir)
callGadget(s=1)
getwd()
callGadget(s=1,ignore.stderr = FALSE)
callGadget(s=1,ignore.stderr = FALSE)
callGadget(s=1,ignore.stderr = FALSE)
s
init.params <- read.gadget.parameters('params.out')
init.params[c('Linf','k','bbin',grep('age',rownames(init.params),value=TRUE),'mat1','mat2'),] <-
read.table(text='switch	value		lower	upper	optimise
Linf	         160	      80     2000        0
k	          90	       1      200        1
bbin	         6	   1e-08    100        1
mult	         1000	     0.1      1000        1
age2	         35	    0.01     150        1
age3	         25	    0.01     120        1
age4	         15	   0.001     100        1
age5	          7	  0.0001     100        1
age6	          7	   1e-05     100        1
age7	          5	   1e-08     100        1
age8	          5	   1e-10     100        1
age9	         25	   1e-12     100        1
age10	         10	   1e-15     100        1
age11	         10	   1e-15    1e+05        1
mat1	          70	      10      200        1
mat2	          70	      30      100        1',header=TRUE)
init.params[c('Linf','k','bbin','mult',grep('age',rownames(init.params),value=TRUE),'mat1','mat2'),] <-
read.table(text='switch	value		lower	upper	optimise
Linf	         160	      80     2000        0
k	          90	       1      200        1
bbin	         6	   1e-08    100        1
mult	         1000	     0.1      1000        1
age2	         35	    0.01     150        1
age3	         25	    0.01     120        1
age4	         15	   0.001     100        1
age5	          7	  0.0001     100        1
age6	          7	   1e-05     100        1
age7	          5	   1e-08     100        1
age8	          5	   1e-10     100        1
age9	         25	   1e-12     100        1
age10	         10	   1e-15     100        1
age11	         10	   1e-15    1e+05        1
mat1	          70	      10      200        1
mat2	          70	      30      100        1',header=TRUE)
View(init.params)
init.params <- read.gadget.parameters('params.out')
init.params[c('Linf','k','bbin','mult',grep('age',rownames(init.params),value=TRUE),'mat1','mat2'),] <-
read.table(text='switch	value		lower	upper	optimise
Linf	         160	      80     2000        0
k	          90	       1      200        1
bbin	         6	   1e-08    100        1
mult	         1000	     0.1      1000        1
age2	         35	    0.01     150        1
age3	         25	    0.01     120        1
age4	         15	   0.001     100        1
age5	          7	  0.0001     100        1
age6	          7	   1e-05     100        1
age7	          5	   1e-08     100        1
age8	          5	   1e-10     100        1
age9	         25	   1e-12     100        1
age10	         10	   1e-15     100        1
age11	         10	   1e-15    1e+05        1
mat1	          70	      10      200        1
mat2	          70	      30      100        1',header=TRUE)
View(init.params)
init.params$switch <- rownames(init.params)
init.params[grepl('rec[0-9]',init.params$switch)]
init.params[grepl('rec[0-9]',init.params$switch),]
init.params[grepl('rec[0-9]',init.params$switch),'value'] <- 30
init.params[grepl('rec[0-9]',init.params$switch),'upper'] <- 200
init.params[grepl('rec[0-9]',init.params$switch),'lower'] <- 0.01
init.params[grepl('rec[0-9]',init.params$switch),'optimise'] <- 1
init.params[grepl('rec[0-9]',init.params$switch),]
opt <- gadget.options(type='simple2stock')
weight.alpha <- 6.5e-6
weight.beta <- 3.07
opt$area$numofareas <- 1
opt$time$firstyear <- 1960
opt$time$lastyear <- 2012
opt$stocks$imm <-
within(opt$stocks$imm,{
name <- 'codimm'
minage <- 1
maxage <- 10
minlength <- 4
maxlength <- 130
dl <- 2
growth <- c(linf='#Linf',k='( * 0.001 #k)',
beta='(* 10 #bbin)', binn=15,recl='#recl')
weight <- c(a=weight.alpha, b=weight.beta)
init.abund <- sprintf('(* %s %s)',c(0,0.1,0.1,0.08,0.06,0.04,0.02,0.01,0,0),
c(0,sprintf('#age%s',2:8),0,0))
n <- sprintf('(* 1000 #rec%s)',1960:2015)
doesmature <- 1
maturityfunction <- 'continuous'
maturestocksandratios <- 'codmat 1'
maturity.coefficients <- '( * 0.001 #mat1) #mat2 0 0'
M <- c(0.5,  0.35, 0.2, 0.2,  0.2, 0.2, 0.2, 0.2, 0.2, 0.3)
maturitysteps <- '0'
doesmove <- 1
transitionstep <- 4
transitionstocksandratios <- "codmat 1"
doesmigrate <- 0
doesrenew <- 1
renewal <- list(minlength=4, maxlength=28)
})
opt$stocks$mat <-
within(opt$stocks$mat,{
name <- 'codmat'
minage <- 3
maxage <- 12
minlength <- 20
maxlength <- 140
dl <- 2
M <- c(0.2,  0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.3, 0.5, 0.7)
growth <- c(linf='#Linf',k='( * 0.001 #k)',
beta='(* 10 #bbin)', binn=15,recl='#recl')
weight <- c(a=3.5e-6, b=3.22)
init.abund <- sprintf('(* %s %s)',c(0,0.02,0.04,0.06,0.08,0.09,0.01,0.001,0.0001,0),
c(0,sprintf('#age%s',4:11),0))
doesmature <- 0
doesmigrate <- 0
})
gm <- gadget.skeleton(time=opt$time, area=opt$area,
stocks=opt$stocks,opt$fleets)
gm@stocks$imm@initialdata$area.factor <- '( * 100 #mult)'
gm@stocks$mat@initialdata$area.factor <- '( * 100 #mult)'
gm@fleets <- list(old.fleet,igfs.fleet,aut.fleet,lln.fleet,gil.fleet,bmt.fleet,foreign.fleet)
library(Rgadget)
opt <- gadget.options(type='simple2stock')
weight.alpha <- 6.5e-6
weight.beta <- 3.07
opt$area$numofareas <- 1
opt$time$firstyear <- 1960
opt$time$lastyear <- 2015
opt$stocks$imm <-
within(opt$stocks$imm,{
name <- 'codimm'
minage <- 1
maxage <- 10
minlength <- 4
maxlength <- 130
dl <- 2
growth <- c(linf='#Linf',k='( * 0.001 #k)',
beta='(* 10 #bbin)', binn=15,recl='#recl')
weight <- c(a=weight.alpha, b=weight.beta)
init.abund <- sprintf('(* %s %s)',c(0,0.1,0.1,0.08,0.06,0.04,0.02,0.01,0,0),
c(0,sprintf('#age%s',2:8),0,0))
n <- sprintf('(* 1000 #rec%s)',1960:2015)
doesmature <- 1
maturityfunction <- 'continuous'
maturestocksandratios <- 'codmat 1'
maturity.coefficients <- '( * 0.001 #mat1) #mat2 0 0'
M <- c(0.5,  0.35, 0.2, 0.2,  0.2, 0.2, 0.2, 0.2, 0.2, 0.3)
maturitysteps <- '0'
doesmove <- 1
transitionstep <- 4
transitionstocksandratios <- "codmat 1"
doesmigrate <- 0
doesrenew <- 1
renewal <- list(minlength=4, maxlength=28)
})
opt$stocks$mat <-
within(opt$stocks$mat,{
name <- 'codmat'
minage <- 3
maxage <- 12
minlength <- 20
maxlength <- 140
dl <- 2
M <- c(0.2,  0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.3, 0.5, 0.7)
growth <- c(linf='#Linf',k='( * 0.001 #k)',
beta='(* 10 #bbin)', binn=15,recl='#recl')
weight <- c(a=3.5e-6, b=3.22)
init.abund <- sprintf('(* %s %s)',c(0,0.02,0.04,0.06,0.08,0.09,0.01,0.001,0.0001,0),
c(0,sprintf('#age%s',4:11),0))
doesmature <- 0
doesmigrate <- 0
})
gm <- gadget.skeleton(time=opt$time, area=opt$area,
stocks=opt$stocks,opt$fleets)
gm@stocks$imm@initialdata$area.factor <- '( * 100 #mult)'
gm@stocks$mat@initialdata$area.factor <- '( * 100 #mult)'
gm@fleets <- list(old.fleet,igfs.fleet,aut.fleet,lln.fleet,gil.fleet,bmt.fleet,foreign.fleet)
setwd("~/Dropbox/gadget-models/01-cod/00-data")
Rgadget:::gadget_dir_write(as.list(gd),gm)
setwd(gd$dir)
callGadget(s=1,ignore.stderr = FALSE)
callGadget(s=1,ignore.stderr = FALSE,log=tmp)
callGadget(s=1,ignore.stderr = FALSE,log='tmp')
eval.gadget.formula('( * #Linf (-  1 (exp (* (* -1 ( * 0.001 #k) ) (- 1 (+ 1 (log (- 1 (/ #recl #Linf)))))))))',init.params)
str_length('( * #Linf (-  1 (exp (* (* -1 ( * 0.001 #k) ) (- 1 (+ 1 (log (- 1 (/ #recl #Linf)))))))))')
callGadget(s=1,ignore.stderr = FALSE)
init.params[grepl('recl',-1] <- c(12, 4, 20)
attach("/u2/reikn/Splus5/GETALK/AGEVISIT/torskur.2015/.RData")
torskur.visit.tot$meanle
torskur.visit.tot$sdev
init.params['recl',-1] <- c(12, 4, 20)
init.params['recl',-1] <- c(12, 4, 20,1)
init.params <- read.gadget.parameters('params.out')
init.params[c('Linf','k','bbin','mult',grep('age',rownames(init.params),value=TRUE),'mat1','mat2'),] <-
read.table(text='switch	value		lower	upper	optimise
Linf	         160	      80     2000        0
k	          90	       1      200        1
bbin	         6	   1e-08    100        1
mult	         1000	     0.1      1000        1
age2	         35	    0.01     150        1
age3	         25	    0.01     120        1
age4	         15	   0.001     100        1
age5	          7	  0.0001     100        1
age6	          7	   1e-05     100        1
age7	          5	   1e-08     100        1
age8	          5	   1e-10     100        1
age9	         25	   1e-12     100        1
age10	         10	   1e-15     100        1
age11	         10	   1e-15    1e+05        1
mat1	          70	      10      200        1
mat2	          70	      30      100        1',header=TRUE)
init.params$switch <- rownames(init.params)
init.params[grepl('rec[0-9]',init.params$switch),'value'] <- 30
init.params[grepl('rec[0-9]',init.params$switch),'upper'] <- 200
init.params[grepl('rec[0-9]',init.params$switch),'lower'] <- 0.01
init.params[grepl('rec[0-9]',init.params$switch),'optimise'] <- 1
init.params['recl',-1] <- c(12, 4, 20,1)
View(init.params)
init.params[grepl('alpha',init.params$switch),'value'] <- 0.5
init.params[grepl('alpha',init.params$switch),'upper'] <- 3
init.params[grepl('alpha',init.params$switch),'lower'] <- 0.01
init.params[grepl('alpha',init.params$switch),'optimise'] <- 1
init.params[grepl('l50',init.params$switch),'value'] <- 50
init.params[grepl('l50',init.params$switch),'upper'] <- 100
init.params[grepl('l50',init.params$switch),'lower'] <- 20
init.params[grepl('l50',init.params$switch),'optimise'] <- 1
write.gadget.parameters(init.params,file='params.in')
fit <- gadget.fit(wgts=NULL,params.file = 'params.in')
traceback()
fit <- gadget.fit(wgts=NULL,params.file = 'params.in')
fit <- gadget.fit(wgts=NULL,params.file = 'params.in')
fit <- gadget.fit(wgts=NULL,params.file = 'params.in')
lik <- read.gadget.likelihood()
lik.dat <- read.gadget.data(lik)
lik.dat <- read.gadget.data(lik,debug=TRUE)
aggdata <- mfdb_sample_count(mdb, c('maturity_stage', 'length','age'),
append(defaults,
list(sampling_type='IGFS',
age=mfdb_group(age=3),
length = mfdb_step_interval('len', by = 2, to = 100),
maturity_stage = mfdb_group(codimm = 1, codmat = 2:5))))
setwd('../00-data/')
gadget_likelihood_component("stockdistribution",
name = "matp.igfs",
weight = 1,
data = aggdata[[1]],
fleetnames = c("igfs"),
stocknames = c("codimm", "codmat")))
gadget_dir_write(gd,
gadget_likelihood_component("stockdistribution",
name = "matp.igfs",
weight = 1,
data = aggdata[[1]],
fleetnames = c("igfs"),
stocknames = c("codimm", "codmat")))
head(aggdata[[1]])
aggdata <- mfdb_sample_count(mdb, c('maturity_stage', 'length','age'),
append(defaults,
list(sampling_type='IGFS',
age=mfdb_group(age3=3),
length = mfdb_step_interval('len', by = 2, to = 100),
maturity_stage = mfdb_group(codimm = 1, codmat = 2:5))))
gadget_dir_write(gd,
gadget_likelihood_component("stockdistribution",
name = "matp.igfs",
weight = 1,
data = aggdata[[1]],
fleetnames = c("igfs"),
stocknames = c("codimm", "codmat")))
devtools::install_github('mareframe/mfdb')
gadget_dir_write(gd,
gadget_likelihood_component("stockdistribution",
name = "matp.igfs",
weight = 1,
data = aggdata[[1]],
fleetnames = c("igfs"),
stocknames = c("codimm", "codmat")))
gd <- gadget_directory("../02-mfdbcod")
gadget_dir_write(gd,
gadget_likelihood_component("stockdistribution",
name = "matp.igfs",
weight = 1,
data = aggdata[[1]],
fleetnames = c("igfs"),
stocknames = c("codimm", "codmat")))
fit <- gadget.fit(wgts=NULL,params.file = 'params.in')
setwd("~/Dropbox/gadget-models/01-cod/02-mfdbcod")
fit <- gadget.fit(wgts=NULL,params.file = 'params.in')
warnings()
warnings()
fit <- gadget.fit(wgts=NULL,params.file = 'params.in')
callGadget(s=1, i='params.in')
callGadget(s=1, i='params.in',ignore.stderr = FALSE)
callGadget(s=1, i='params.in',ignore.stderr = FALSE)
callGadget(s=1, i='params.in',ignore.stderr = FALSE,log='tmp')
setwd("~/Dropbox/Shared/Metill/RfraGrunni")
install.packages('tidyr')
Rgadget:::getMaxlength(gm)
getwd()
devtools::install_github('mareframe/mfdb',ref='3.x')
q()
n
)
head(aggdata$'0.0.0.0.0')
filter(aggdata[[1]],step==4)
filter(aggdata[1],step==4)
class(aggdata[[1]])
filter(aggdata[1],step==4)
filter(aggdata[[1]],step==4)
tmp <- aggdata[[1]]
tmp
str(tmp)
filter(aggdata[[1]],step=='4')
names(tmp)
filter(tmp,step=='4')
subset(tmp,step=='4')
tmp <- mfdb_sample_meanlength_stddev(mdb,c('age'),c(list(sampling_type='IGFS',defaults)
tmp <- mfdb_sample_meanlength_stddev(mdb,c('age'),c(list(sampling_type='IGFS'),defaults))
head(tmp[[1]])
tmp <- mfdb_sample_meanlength_stddev(mdb,c('age'),c(list(sampling_type='IGFS',age=1),defaults))
head(tmp[[1]])
ggplot(tmp[[1]],aes(year,mean)) + geom_line()
library(ggplot2)
ggplot(tmp[[1]],aes(year,mean)) + geom_line()
tmp <- mfdb_sample_meanlength_stddev(mdb,c('age'),c(list(sampling_type='IGFS',age=1:12),defaults))
ggplot(tmp[[1]],aes(year,mean,col=as.factor(age))) + geom_line()
ggplot(tmp[[1]],aes(year,stddev,col=as.factor(age))) + geom_line()
summary(tmp[[1]])
ggplot(tmp[[1]],aes(age,mean)) + geom_boxplot()
ggplot(tmp[[1]],aes(age,mean,grouping=age)) + geom_boxplot()
ggplot(tmp[[1]],aes(age,mean,group=age)) + geom_boxplot()
mla <- tpm
mla <- tmp
opt$stocks$imm$sigma
mla[[1]] %>% group_by(age) %>% summarise(ml=mean(mean), ms = mean(stddev))
mla[[1]] %>% group_by(age) %>% summarise(ml=mean(mean), ms = mean(stddev,na.rm=TRUE))
gd
q()
n
library(mfdb)
library(Rgadget)
save(aggdata,file='aut.RData')
attributes(aggdata[[1]])$age
devtools::install_github('mareframe/mfdb')
 q()
n
library(mfdb)
library(Rgadget)
devtools::install_github('mareframe/mfdb',ref='3.x')
q()
n
